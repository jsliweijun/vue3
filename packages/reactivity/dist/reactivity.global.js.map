{"version":3,"file":"reactivity.global.js","sources":["../../shared/src/index.ts","../src/baseHandlers.ts","../src/reactive.ts"],"sourcesContent":["const Shared = {};\n\nexport default Shared;\n\nexport function isObject(val: Object) {\n    return typeof val === 'object' && val !== null;\n}\n\nexport const extend = Object.assign;\n","// 创建 4 个 Proxy 到配置对象 new Proxy(target,handler)\n\nimport { extend, isObject } from '@vue/shared';\nimport { reactive, readonly } from './reactive';\n\n//是不是仅读， 没有set 方法\n// 是不是深度，\n\n/**\n *\n * @param isReadonly\n * @param shallow\n * @returns\n */\nfunction createGetter(isReadonly = false, shallow = false) {\n    return function get(target: object, key: string, receiver: object) {\n        const res = Reflect.get(target, key, receiver); // target[key]\n\n        // 收集依赖\n        if (!isReadonly) {\n        }\n\n        if (shallow) {\n            return res;\n        }\n\n        // 返回值是否为对象，要进行深层代理, 这是懒代理。\n        if (isObject(res)) {\n            return isReadonly ? readonly(res) : reactive(res);\n        }\n\n        return res;\n    };\n}\n\nconst get = createGetter();\nconst shollowGet = createGetter(false, true);\nconst readonlyGet = createGetter(true);\nconst showllowReadonlyGet = createGetter(true, true);\n\nfunction createSetter(shallow = false) {}\n\nconst set = createSetter();\nconst shallowSet = createSetter(true);\n\nexport const mutableHandlers = { get };\nexport const shallowReactiveHandlers = { get: shollowGet };\n\nlet readonlyObj = {\n    set: (target: object, key: string) => {\n        console.warn(`set on key ${key}  failed`);\n    }\n};\n\nexport const readonlyHandlers = extend(\n    {\n        get: readonlyGet\n    },\n    readonlyObj\n);\nexport const shallowReaconlyHandlers = extend({ get: showllowReadonlyGet }, readonlyObj);\n","// 对外提供四个 核心 API ， 对传入的对象实现相应式\n// 是不是仅读，是不是深度， 克里化，通过参数判断。 统一实现响应式方法\n// new Proxy(target,handler)\n\nimport { mutableHandlers, shallowReaconlyHandlers, shallowReactiveHandlers, readonlyHandlers } from './baseHandlers';\n\nimport { isObject } from '@vue/shared';\n\n// 将代理配置对象封装到另外一个文件\n\nexport function reactive(target: any) {\n    return createReactiveObject(target, false, mutableHandlers);\n}\nexport function shallowReactive(target: any) {\n    return createReactiveObject(target, false, shallowReactiveHandlers);\n}\nexport function readonly(target: any) {\n    return createReactiveObject(target, true, readonlyHandlers);\n}\nexport function shallowReadonly(target: any) {\n    return createReactiveObject(target, true, shallowReaconlyHandlers);\n}\n\nconst reactiveMap = new WeakMap();\nconst readonlyMap = new WeakMap();\n\n/**\n *\n * @param target 目标对象\n * @param isReadonly  是否只读\n * @param baseHandlers Proxy 的配置对象 get/set\n */\nexport function createReactiveObject(target: Object, isReadonly: Boolean, baseHandlers: Object) {\n    // target 只能是对象\n    if (!isObject(target)) {\n        return target;\n    }\n\n    // 记录对象是否被代理过,代理过就不被代理\n    const proxyMap = isReadonly ? readonlyMap : reactiveMap;\n\n    const existProxy = proxyMap.get(target);\n    if (existProxy) {\n        return existProxy;\n    }\n\n    // 创建代理对象，并记录\n    const p = new Proxy(target, baseHandlers);\n    proxyMap.set(target, p);\n\n    return p;\n}\n"],"names":[],"mappings":";;;aAIgB,QAAQ,CAAC,GAAW;QAChC,OAAO,OAAO,GAAG,KAAK,QAAQ,IAAI,GAAG,KAAK,IAAI,CAAC;IACnD,CAAC;IAEM,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM;;ICRnC;IAKA;IACA;IAEA;;;;;;IAMA,SAAS,YAAY,CAAC,UAAU,GAAG,KAAK,EAAE,OAAO,GAAG,KAAK;QACrD,OAAO,SAAS,GAAG,CAAC,MAAc,EAAE,GAAW,EAAE,QAAgB;YAC7D,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;YAM/C,IAAI,OAAO,EAAE;gBACT,OAAO,GAAG,CAAC;aACd;;YAGD,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;gBACf,OAAO,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC;aACrD;YAED,OAAO,GAAG,CAAC;SACd,CAAC;IACN,CAAC;IAED,MAAM,GAAG,GAAG,YAAY,EAAE,CAAC;IAC3B,MAAM,UAAU,GAAG,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;IAC7C,MAAM,WAAW,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;IACvC,MAAM,mBAAmB,GAAG,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IAO9C,MAAM,eAAe,GAAG,EAAE,GAAG,EAAE,CAAC;IAChC,MAAM,uBAAuB,GAAG,EAAE,GAAG,EAAE,UAAU,EAAE,CAAC;IAE3D,IAAI,WAAW,GAAG;QACd,GAAG,EAAE,CAAC,MAAc,EAAE,GAAW;YAC7B,OAAO,CAAC,IAAI,CAAC,cAAc,GAAG,UAAU,CAAC,CAAC;SAC7C;KACJ,CAAC;IAEK,MAAM,gBAAgB,GAAG,MAAM,CAClC;QACI,GAAG,EAAE,WAAW;KACnB,EACD,WAAW,CACd,CAAC;IACK,MAAM,uBAAuB,GAAG,MAAM,CAAC,EAAE,GAAG,EAAE,mBAAmB,EAAE,EAAE,WAAW,CAAC;;IC5DxF;IAQA;aAEgB,QAAQ,CAAC,MAAW;QAChC,OAAO,oBAAoB,CAAC,MAAM,EAAE,KAAK,EAAE,eAAe,CAAC,CAAC;IAChE,CAAC;aACe,eAAe,CAAC,MAAW;QACvC,OAAO,oBAAoB,CAAC,MAAM,EAAE,KAAK,EAAE,uBAAuB,CAAC,CAAC;IACxE,CAAC;aACe,QAAQ,CAAC,MAAW;QAChC,OAAO,oBAAoB,CAAC,MAAM,EAAE,IAAI,EAAE,gBAAgB,CAAC,CAAC;IAChE,CAAC;aACe,eAAe,CAAC,MAAW;QACvC,OAAO,oBAAoB,CAAC,MAAM,EAAE,IAAI,EAAE,uBAAuB,CAAC,CAAC;IACvE,CAAC;IAED,MAAM,WAAW,GAAG,IAAI,OAAO,EAAE,CAAC;IAClC,MAAM,WAAW,GAAG,IAAI,OAAO,EAAE,CAAC;IAElC;;;;;;aAMgB,oBAAoB,CAAC,MAAc,EAAE,UAAmB,EAAE,YAAoB;;QAE1F,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;YACnB,OAAO,MAAM,CAAC;SACjB;;QAGD,MAAM,QAAQ,GAAG,UAAU,GAAG,WAAW,GAAG,WAAW,CAAC;QAExD,MAAM,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QACxC,IAAI,UAAU,EAAE;YACZ,OAAO,UAAU,CAAC;SACrB;;QAGD,MAAM,CAAC,GAAG,IAAI,KAAK,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;QAC1C,QAAQ,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAExB,OAAO,CAAC,CAAC;IACb;;;;;;;;;;;;;;;"}